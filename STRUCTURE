#STACKS in STRUCTURE format
#!/bin/sh
#SBATCH --partition=bio
#SBATCH --ntasks=1
#SBATCH --tasks-per-node=1
#SBATCH --mem=214G
#SBATCH --time=5-00:00:00

export PATH=$PATH:/home/asrix/bin/stacks-2.53
module load lang/Python/3.5.2-pic-intel-2016b
cd /center1/FISHPOPG/asrix/LTrout/Data/STACKS/LT_one_per_fish
mkdir STRUCTURE
populations -P . -M /center1/FISHPOPG/asrix/LTrout/Data/popmapLT2 -r 0.8 -O ./STRUCTURE --vcf --genepop --fstats --smooth --hwe -t 8 --structure --write-random-snp --ordered-export

#Number of SNPs
head -n 1 /center1/FISHPOPG/asrix/LTrout/Data/STACKS/LT_one_per_fish/STRUCTURE/populations.structure | tr "\t" "\n" | grep -v "^$" | wc -l
#51500
#Look here for help https://simison.com/brian/Structure_notes.html

#!/bin/sh
#SBATCH --partition=bio
#SBATCH --ntasks=1
#SBATCH --tasks-per-node=1
#SBATCH --mem=214G
#SBATCH --time=10-00:00:00
#PBS -N STRUCTURE

cd /center1/FISHPOPG/asrix/LTrout/Data/STACKS/LT_one_per_fish/STRUCTURE

for k in 2 3 4 5 6 7 8 9; do /home/asrix/bin/console/structure -m /home/asrix/bin/console/mainparams -e /home/asrix/bin/console/extraparams \
-s /home/asrix/bin/console/stratparams -K $k -i populations.structure -o structure.$k; done


#BELOW HERE NEEDS EDITTING

in R, but first need missing data from structure to be encoded by -9 not 0
sed -i '' 's:0$(printf '\t'):-9$(printf '\t'):g' populations.structure2
awk  '{gsub("0<Tab>","-9<Tab>",$0); print;}' populations.structure2
#BOTH FAIL, but
sed -i 's:0\t:-9\t:g' populations.structure2
#works with linux not MACOS
#Full dataset not loading into R, trying with smaller set used for GIU STRUCTURE.

#STRUCTURE IMAGES-distruct
wget https://web.stanford.edu/group/rosenberglab/software/distruct1.1.tar.gz
gunzip distruct1.1.tar.gz
tar xvf distruct1.1.tar

/home/asrix/bin/distruct1.1/distructLinux1.1

-d drawparams
-K K
-M NUMPOPS
-N NUMINDS
-p input file (population q's)
-i input file (individual q's)
-a input file (labels atop figure)
-b input file (labels below figure)
-c input file (cluster permutation)
-o output file

/home/asrix/bin/distruct1.1/distructLinux1.1 -d drawparams -K 2 -M 7 -N 294 -p 2structure.popq -i 2structure.indivq -a structure.names -b structure.languages -o 2structure
#gives file, not image, but when opened with Preview makes a PDF

/home/asrix/bin/distruct1.1/distructLinux1.1 -d drawparams -K 5 -M 7 -N 294 -p 5structure.popq -i 5structure.indivq -a structure.names -b structure.languages -o 5structure
